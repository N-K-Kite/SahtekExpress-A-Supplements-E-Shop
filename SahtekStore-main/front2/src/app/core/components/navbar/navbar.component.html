<nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
    <div class="container">
        <a class="navbar-brand" href="/">
            <div class="brand-wrapper">
                <i class="bi bi-lightning-charge-fill brand-icon"></i>
                <span class="brand-text">Sahtek Nutrition</span>
            </div>
        </a>

        <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mx-auto">
                <li class="nav-item">
                    <a class="nav-link" routerLink="/" routerLinkActive="active"
                        [routerLinkActiveOptions]="{exact: true}">
                        <i class="bi bi-house-door me-1"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="nav-item category-dropdown">
                    <a class="nav-link" routerLink="/categories" routerLinkActive="active">
                        <i class="bi bi-grid me-1"></i>
                        <span>Categories</span>
                        <i class="bi bi-chevron-down ms-1 small"></i>
                    </a>
                    <div class="mega-menu">
                        <div class="mega-menu-content">
                            <div class="row g-4">
                                <div class="col-md-4" *ngFor="let cat of categories">
                                    <a class="category-item" [routerLink]="['/categories', cat.slug]">
                                        <div class="category-icon">
                                            <i class="bi" [ngClass]="cat.icon"></i>
                                        </div>
                                        <div class="category-info">
                                            <span class="category-name">{{ cat.displayName }}</span>
                                            <p class="category-desc">{{ cat.description }}</p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                            <div class="mega-menu-footer">
                                <a routerLink="/categories" class="view-all">
                                    Voir toutes les catégories <i class="bi bi-arrow-right ms-1"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" [routerLink]="['/']" fragment="footer">
                        <i class="bi bi-info-circle me-1"></i>
                        <span>About</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" [routerLink]="['/']" fragment="contact">
                        <i class="bi bi-telephone me-1"></i>
                        <span>Contact</span>
                    </a>
                </li>
            </ul>

            <div class="navbar-actions">
                <div class="search-bar-container" [class.active]="showSearch">
                    <button class="btn-nav-action" type="button" (click)="handleSearchClick()">
                        <i class="bi bi-search"></i>
                    </button>
                    <input type="text" class="search-input" placeholder="Rechercher..." [(ngModel)]="searchQuery"
                        (keyup.enter)="onSearch()">
                </div>
                <a class="btn-nav-action position-relative" routerLink="/cart">
                    <i class="bi bi-cart3"></i>
                    <span class="cart-badge" *ngIf="(cart$ | async)?.totalItems as count">{{ count }}</span>
                </a>

                <!-- Profile Dropdown -->
                <div class="profile-dropdown-container">
                    <button class="btn-nav-action" type="button" (click)="toggleProfileDropdown()">
                        <i class="bi bi-person"></i>
                        <span *ngIf="isLoggedIn" class="online-indicator"></span>
                    </button>

                    <div class="profile-dropdown" *ngIf="showProfileDropdown">
                        <div *ngIf="isLoggedIn" class="dropdown-content">
                            <div class="user-info">
                                <div class="user-avatar">
                                    <i class="bi bi-person-circle"></i>
                                </div>
                                <div class="user-details">
                                    <span class="user-name">{{ currentUser?.firstName || currentUser?.email ||
                                        'Utilisateur' }}</span>
                                    <span class="user-status">
                                        <i class="bi bi-circle-fill connected"></i> Connecté
                                    </span>
                                </div>
                            </div>
                            <hr class="dropdown-divider">
                            <a *ngIf="!isAdmin" routerLink="/profile" class="dropdown-btn"
                                (click)="showProfileDropdown = false">
                                <i class="bi bi-person-gear me-2"></i>
                                Mon Profil
                            </a>
                            <button class="dropdown-btn logout-btn" (click)="logout()">
                                <i class="bi bi-box-arrow-right me-2"></i>
                                Déconnexion
                            </button>
                            <a *ngIf="isAdmin" routerLink="/admin" class="dropdown-btn admin-nav-btn"
                                (click)="showProfileDropdown = false">
                                <i class="bi bi-shield-lock me-2"></i>
                                Administratif
                            </a>
                        </div>

                        <div *ngIf="!isLoggedIn" class="dropdown-content">
                            <div class="guest-info">
                                <i class="bi bi-person-x-fill guest-icon"></i>
                                <span class="guest-text">Non connecté</span>
                            </div>
                            <hr class="dropdown-divider">
                            <a routerLink="/login" class="dropdown-btn login-btn">
                                <i class="bi bi-box-arrow-in-right me-2"></i>
                                Connexion
                            </a>
                            <a routerLink="/register" class="dropdown-btn register-btn">
                                <i class="bi bi-person-plus me-2"></i>
                                Inscription
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>