<div class="auth-container">
    <div class="auth-card glass-morphism">
        <div class="auth-header">
            <div class="brand-logo mb-4">
                <i class="bi bi-lightning-charge-fill"></i>
                <span>Sahtek <small>Nutrition</small></span>
            </div>

            <ng-container *ngIf="!submitted">
                <h2 class="auth-title">Réinitialiser le mot de passe</h2>
                <p class="auth-subtitle">Saisissez votre email et votre code PIN secret.</p>
            </ng-container>

            <ng-container *ngIf="submitted">
                <div class="success-icon mb-4">
                    <i class="bi bi-check2-circle"></i>
                </div>
                <h2 class="auth-title">Succès !</h2>
                <p class="auth-subtitle">Votre mot de passe a été modifié avec succès.</p>
            </ng-container>
        </div>

        <div class="auth-body">
            <form *ngIf="!submitted" (ngSubmit)="onSubmit()" #resetForm="ngForm">
                <!-- EMAIL -->
                <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com"
                        [(ngModel)]="email" required email #emailModel="ngModel">
                    <label for="email">Adresse Email</label>
                    <div class="invalid-feedback d-block"
                        *ngIf="emailModel.invalid && (emailModel.dirty || emailModel.touched)">
                        Email invalide.
                    </div>
                </div>

                <!-- PIN SECRET -->
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="pin" name="pin" placeholder="Code PIN" [(ngModel)]="pin"
                        required minlength="4" maxlength="6" #pinModel="ngModel">
                    <label for="pin">Code PIN Secret</label>
                    <div class="invalid-feedback d-block"
                        *ngIf="pinModel.invalid && (pinModel.dirty || pinModel.touched)">
                        Code PIN requis (4-6 caractères).
                    </div>
                </div>

                <!-- NOUVEAU MOT DE PASSE -->
                <div class="form-floating mb-4">
                    <input type="password" class="form-control" id="newPassword" name="newPassword"
                        placeholder="Nouveau mot de passe" [(ngModel)]="newPassword" required minlength="6"
                        #pwdModel="ngModel">
                    <label for="newPassword">Nouveau mot de passe</label>
                    <div class="invalid-feedback d-block"
                        *ngIf="pwdModel.invalid && (pwdModel.dirty || pwdModel.touched)">
                        Minimum 6 caractères.
                    </div>
                </div>

                <div *ngIf="errorMessage" class="alert alert-danger-premium mb-4">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    {{ errorMessage }}
                </div>

                <button type="submit" class="btn-premium w-100" [disabled]="resetForm.invalid || loading">
                    <span *ngIf="!loading">Réinitialiser maintenant</span>
                    <span *ngIf="loading" class="spinner-border spinner-border-sm" role="status"></span>
                </button>
            </form>

            <div *ngIf="submitted" class="success-actions text-center">
                <a routerLink="/login"
                    class="btn-premium w-100 text-decoration-none d-flex justify-content-center align-items-center">
                    Se connecter
                </a>
            </div>

            <div class="auth-footer mt-4 text-center">
                <a routerLink="/login" class="back-to-login">
                    <i class="bi bi-arrow-left me-2"></i>
                    Retour à la connexion
                </a>
            </div>
        </div>
    </div>
</div>