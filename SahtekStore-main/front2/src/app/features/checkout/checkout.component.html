<div class="checkout-page py-5">
    <div class="container" *ngIf="cart$ | async as cart">
        <div class="row g-5">
            <!-- Left Column: Checkout Form -->
            <div class="col-lg-8">
                <div class="checkout-form-container">
                    <h2 class="section-title mb-4">Informations de Commande</h2>

                    <form #checkoutForm="ngForm" (ngSubmit)="placeOrder()">
                        <!-- Personal Information -->
                        <div class="form-section mb-5">
                            <h4 class="form-subtitle mb-3"><i class="bi bi-person-circle me-2"></i>Informations
                                Personnelles</h4>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Prénom</label>
                                    <input type="text" class="form-control" name="firstName"
                                        [(ngModel)]="checkoutData.firstName" required placeholder="Ex: Jean">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Nom</label>
                                    <input type="text" class="form-control" name="lastName"
                                        [(ngModel)]="checkoutData.lastName" required placeholder="Ex: Dupont">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" name="email"
                                        [(ngModel)]="checkoutData.email" required placeholder="jean.dupont@email.com">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Téléphone</label>
                                    <input type="tel" class="form-control" name="phone" [(ngModel)]="checkoutData.phone"
                                        required placeholder="Ex: +216 55 123 456">
                                </div>
                            </div>
                        </div>

                        <!-- Shipping Information -->
                        <div class="form-section mb-5">
                            <h4 class="form-subtitle mb-3"><i class="bi bi-truck me-2"></i>Adresse de Livraison</h4>
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label">Adresse Complète</label>
                                    <textarea class="form-control" name="address" [(ngModel)]="checkoutData.address"
                                        required rows="2" placeholder="N° Rue, Appartement, etc."></textarea>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Ville</label>
                                    <input type="text" class="form-control" name="city" [(ngModel)]="checkoutData.city"
                                        required placeholder="Ex: Tunis">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Code Postal</label>
                                    <input type="text" class="form-control" name="zipCode"
                                        [(ngModel)]="checkoutData.zipCode" required placeholder="Ex: 1000">
                                </div>
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div class="form-section mb-5">
                            <h4 class="form-subtitle mb-3"><i class="bi bi-credit-card me-2"></i>Méthode de Paiement
                            </h4>
                            <div class="payment-options">
                                <div class="payment-card" [class.active]="checkoutData.paymentMethod === 'LAIVRAISON'"
                                    (click)="checkoutData.paymentMethod = 'LAIVRAISON'">
                                    <input type="radio" name="paymentMethod" value="LAIVRAISON"
                                        [(ngModel)]="checkoutData.paymentMethod" class="d-none">
                                    <div class="payment-icon">
                                        <i class="bi bi-truck"></i>
                                    </div>
                                    <span>Paiement à la livraison</span>
                                </div>
                                <div class="payment-card flouci-card"
                                    [class.active]="checkoutData.paymentMethod === 'FLOUCI'"
                                    (click)="checkoutData.paymentMethod = 'FLOUCI'">
                                    <input type="radio" name="paymentMethod" value="FLOUCI"
                                        [(ngModel)]="checkoutData.paymentMethod" class="d-none">
                                    <div class="payment-icon flouci-wrapper">
                                        <img src="assets/images/flouci.png" alt="Flouci" class="flouci-logo">
                                    </div>
                                    <span>Paiement par Flouci</span>
                                </div>
                                <div class="payment-card"
                                    [class.active]="checkoutData.paymentMethod === 'CARTE BANCAIREE'"
                                    (click)="checkoutData.paymentMethod = 'CARTE BANCAIREE'">
                                    <input type="radio" name="paymentMethod" value="CARTE BANCAIREE"
                                        [(ngModel)]="checkoutData.paymentMethod" class="d-none">
                                    <div class="payment-icon">
                                        <i class="bi bi-credit-card-2-front"></i>
                                    </div>
                                    <span>Carte Bancaire</span>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-place-order w-100 py-3"
                            [disabled]="!checkoutForm.valid || isSubmitting || cart.items.length === 0">
                            <span *ngIf="!isSubmitting">PASSER LA COMMANDE</span>
                            <span *ngIf="isSubmitting"><i class="bi bi-arrow-repeat spin me-2"></i>TRAITEMENT EN
                                COURS...</span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Right Column: Order Summary -->
            <div class="col-lg-4">
                <div class="order-summary-card">
                    <h3 class="summary-title mb-4">Résumé de la Commande</h3>

                    <div class="summary-items mb-4">
                        <div class="summary-item" *ngFor="let item of cart.items">
                            <div class="item-img">
                                <img [src]="getItemImage(item)" [alt]="item.productName">
                                <span class="item-qty-badge">{{ getItemQuantity(item) }}</span>
                            </div>
                            <div class="item-details">
                                <h6 class="mb-0">{{ item.productName }}</h6>
                                <small class="text-secondary">{{ getItemPrice(item) | number:'1.2-2' }} TND</small>
                            </div>
                            <div class="item-total">
                                {{ (getItemPrice(item) * getItemQuantity(item)) | number:'1.2-2' }} TND
                            </div>
                        </div>
                    </div>

                    <!-- Promo Code -->
                    <div class="promo-section mb-4">
                        <div class="input-group">
                            <input type="text" class="form-control promo-input" placeholder="Code Promo"
                                [(ngModel)]="checkoutData.promoCode">
                            <button class="btn btn-apply" type="button" (click)="applyPromo()">Appliquer</button>
                        </div>
                    </div>

                    <div class="summary-totals pt-4 border-top">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-secondary">Sous-total</span>
                            <span>{{ cart.totalAmount | number:'1.2-2' }} TND</span>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span class="text-secondary">Livraison</span>
                            <span class="text-success">Gratuite</span>
                        </div>
                        <div class="d-flex justify-content-between total-row border-top pt-3">
                            <span class="fw-bold">TOTAL</span>
                            <span class="fw-bold fs-4">{{ cart.totalAmount | number:'1.2-2' }} TND</span>
                        </div>
                    </div>
                </div>

                <div class="security-info mt-4">
                    <div class="d-flex align-items-center gap-3 text-secondary small">
                        <i class="bi bi-shield-check fs-4"></i>
                        <span>Paiement 100% sécurisé et protection de vos données personnelles.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>